angular.module("easyTimepicker",[]).constant("EasyTimepickerConfig",{minuteStep:15,showMeridian:!0,meridians:["AM","PM"],widgetColClass:"col-xs-4",incIconClass:"icon-chevron-up",decIconClass:"icon-chevron-down"}).directive("ezTimepicker",["$compile","$document","EasyTimepickerConfig",function(a,b,c){return{restrict:"EA",required:"?^ngModel",scope:{toggler:"=ezTimepicker",time:"=ngModel"},link:function(d,e,f){d.minuteStep=parseInt(f.minuteStep,10)||c.minuteStep,d.showMeridian=d.$eval(f.showMeridian)||c.showMeridian,d.meridians=f.meridians||c.meridians,d.widgetColClass=f.widgetColClass||c.widgetColClass,d.incIconClass=f.incIconClass||c.incIconClass,d.decIconClass=f.decIconClass||c.decIconClass,d.widget={},e.on("blur",function(){n(e.val()),e.val(m)}),d.incrementHours=function(){d.showMeridian?11===d.widget.hours?(d.widget.hours++,d.toggleMeridian()):12===d.widget.hours?d.widget.hours=1:d.widget.hours++:23===d.widget.hours?d.widget.hours=0:d.widget.hours++},d.decrementHours=function(){d.widget.hours--,0===d.widget.hours?d.widget.hours=d.showMeridian?12:23:11===d.widget.hours&&d.showMeridian&&d.toggleMeridian()},d.incrementMinutes=function(){d.widget.minutes=parseInt(d.widget.minutes,10)+d.minuteStep,d.widget.minutes>=60&&(d.widget.minutes=0,d.incrementHours()),g()},d.decrementMinutes=function(){d.widget.minutes=d.widget.minutes-d.minuteStep,parseInt(d.widget.minutes,10)<0&&(d.decrementHours(),d.widget.minutes+=60),g()},d.toggleMeridian=function(){d.widget.meridian=d.widget.meridian===d.meridians[0]?d.meridians[1]:d.meridians[0]};var g=function(){parseInt(d.widget.minutes,10)>=60&&(d.widget.minutes=0,d.incrementHours()),parseInt(d.widget.minutes,10)<10&&(d.widget.minutes="0"+parseInt(d.widget.minutes,10))},h=function(){angular.isDefined(d.widget.hours)||angular.isDefined(d.widget.minutes)?n(d.widget.hours+":"+d.widget.minutes+" "+d.widget.meridian):n(d.time),d.time=m()},i=function(a){a.originalEvent&&(a=a.originalEvent);var b=a.wheelDelta?a.wheelDelta:-a.deltaY;return a.detail||b>0},j=function(a){d.$apply(i(a)?d.incrementHours():d.decrementHours()),a.preventDefault()},k=function(a){d.$apply(i(a)?d.incrementMinutes():d.decrementMinutes()),a.preventDefault()},l=function(a){d.$apply(d.toggleMeridian()),a.preventDefault()},m=function(){return d.widget.hours+":"+d.widget.minutes+" "+d.widget.meridian},n=function(a){var b,c,e,f;a?(d.widget.meridian=a.match(new RegExp(d.meridians[1].substring(0,1),"i"))?d.meridians[1]:d.meridians[0],b=a.replace(/[^0-9\:]/g,"").split(":"),e=b[0]?b[0].toString():b.toString(),f=b[1]?b[1].toString():"",e.length>2&&(f=e.substr(2,2),e=e.substr(0,2)),f.length>2&&(f=f.substr(0,2)),e=parseInt(e,10),f=parseInt(f,10),isNaN(e)&&(e=0),isNaN(f)&&(f=0)):(c=new Date,e=c.getHours(),f=c.getMinutes(),d.widget.meridian=d.showMeridian&&e>=12?d.meridians[1]:d.meridians[0]),d.showMeridian?0===e?d.widget.hours=12:e>12?(d.widget.hours=e-12,d.widget.meridian=d.meridians[1]):d.widget.hours=e:d.widget.hours=e,d.widget.minutes=Math.ceil(f/d.minuteStep)*d.minuteStep,g()},o=function(a){a.preventDefault(),a.stopPropagation()},p=function(a){o(a),d.toggler&&d.$apply(function(){d.toggler=!1,b.off("click",p)})};d.$watch("toggler",function(a){a===!0?(n(d.time),e.on("click",p),e.parent().on("click",o),b.on("click",p),e.parent().find(".hours-col").on("mousewheel wheel",j),e.parent().find(".minutes-col").on("mousewheel wheel",k),e.parent().find(".meridian-col").on("mousewheel wheel",l)):(e.off("click",p),e.parent().off("click",o),b.off("click",p),e.parent().find(".hours-col").off("mousewheel wheel",j),e.parent().find(".minutes-col").off("mousewheel wheel",k),e.parent().find(".meridian-col").off("mousewheel wheel",l))}),d.$watch("widget",function(){h()},!0);var q=angular.element(document.createElement("div")).attr("ng-include","'easy-timepicker.html'");a(q)(d),e.after(q)}}}]);