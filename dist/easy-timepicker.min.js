angular.module("easyTimepicker",[]).constant("EasyTimepickerConfig",{minuteStep:15,showMeridian:!0,meridians:["AM","PM"],inputClass:"form-control",inputContainerClass:"input-group",clockIconClass:"icon-clock",widgetColClass:"col-xs-4",incIconClass:"icon-chevron-up",decIconClass:"icon-chevron-down"}).directive("ezTimepicker",["$compile","$document","EasyTimepickerConfig",function(a,b,c){return{restrict:"EA",replace:!0,templateUrl:"easy-timepicker.html",scope:{time:"=ezTimepicker"},link:function(a,b,d){a.minuteStep=parseInt(d.minuteStep,10)||c.minuteStep,a.showMeridian=a.$eval(d.showMeridian)||c.showMeridian,a.meridians=d.meridians||c.meridians,a.inputClass=d.inputClass||c.inputClass,a.inputContainerClass=d.inputContainerClass||c.inputContainerClass,a.clockIconClass=d.inputContainerClass||c.clockIconClass,a.widgetColClass=d.widgetColClass||c.widgetColClass,a.incIconClass=d.incIconClass||c.incIconClass,a.decIconClass=d.decIconClass||c.decIconClass,a.widget={},a.updateFromInput=function(){k(a.time)},a.preventDefault=function(a){a.preventDefault(),a.stopPropagation()},a.incrementHours=function(){a.showMeridian?11===a.widget.hours?(a.widget.hours++,a.toggleMeridian()):12===a.widget.hours?a.widget.hours=1:a.widget.hours++:23===a.widget.hours?a.widget.hours=0:a.widget.hours++},a.decrementHours=function(){a.widget.hours--,0===a.widget.hours?a.widget.hours=a.showMeridian?12:23:11===a.widget.hours&&a.showMeridian&&a.toggleMeridian()},a.incrementMinutes=function(){a.widget.minutes=parseInt(a.widget.minutes,10)+a.minuteStep,a.widget.minutes>=60&&(a.widget.minutes=0,a.incrementHours()),e()},a.decrementMinutes=function(){a.widget.minutes=a.widget.minutes-a.minuteStep,parseInt(a.widget.minutes,10)<0&&(a.decrementHours(),a.widget.minutes+=60),e()},a.toggleMeridian=function(){a.widget.meridian=a.widget.meridian===a.meridians[0]?a.meridians[1]:a.meridians[0]};var e=function(){parseInt(a.widget.minutes,10)>=60&&(a.widget.minutes=0,a.incrementHours()),parseInt(a.widget.minutes,10)<10&&(a.widget.minutes="0"+parseInt(a.widget.minutes,10))},f=function(){angular.isDefined(a.widget.hours)&&angular.isDefined(a.widget.minutes)?a.time=a.widget.hours+":"+a.widget.minutes+" "+a.widget.meridian:k(a.time)},g=function(a){a.originalEvent&&(a=a.originalEvent);var b=a.wheelDelta?a.wheelDelta:-a.deltaY;return a.detail||b>0},h=function(b){a.$apply(g(b)?a.incrementHours():a.decrementHours()),b.preventDefault()},i=function(b){a.$apply(g(b)?a.incrementMinutes():a.decrementMinutes()),b.preventDefault()},j=function(b){a.$apply(a.toggleMeridian()),b.preventDefault()},k=function(b){var c,d,f,g;b?(a.widget.meridian=b.match(new RegExp(a.meridians[1].substring(0,1),"i"))?a.meridians[1]:a.meridians[0],c=b.replace(/[^0-9\:]/g,"").split(":"),f=c[0]?c[0].toString():c.toString(),g=c[1]?c[1].toString():"",f.length>2&&(g=f.substr(2,2),f=f.substr(0,2)),g.length>2&&(g=g.substr(0,2)),f=parseInt(f,10),g=parseInt(g,10),isNaN(f)&&(f=0),isNaN(g)&&(g=0)):(d=new Date,f=d.getHours(),g=d.getMinutes(),a.widget.meridian=a.showMeridian&&f>=12?a.meridians[1]:a.meridians[0]),a.showMeridian?0===f?a.widget.hours=12:f>12?(a.widget.hours=f-12,a.widget.meridian=a.meridians[1]):a.widget.hours=f:a.widget.hours=f,a.widget.minutes=Math.ceil(g/a.minuteStep)*a.minuteStep,e(),a.time=a.widget.hours+":"+a.widget.minutes+" "+a.widget.meridian};b.find(".hours-col").on("mousewheel wheel",h),b.find(".minutes-col").on("mousewheel wheel",i),b.find(".meridian-col").on("mousewheel wheel",j),a.$watch("widget",function(){f()},!0)}}}]);